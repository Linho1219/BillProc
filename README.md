# BillProc

将同济校园卡的流水信息转换为 [小星记账 App](https://cxincx.com/) 接受的 `.csv` 导入格式。

> [!warning]
>
> **重要提示**
>
> 账单处理规则在仓库的 `src/config.ts` 中，但仅包含仓库作者平时在校园的消费。如果你需要添加更多的处理规则，需要你对 TypeScript 有一定的了解。**请自行 fork 仓库并添加所需的规则，本仓库不接受与处理规则有关的任何 Issue 或 PR。**

## GUI 使用指南

使用桌面端浏览器打开 [同济校园卡个人页面](https://yikatong.tongji.edu.cn/User/User)，导航到「流水信息」，选择合适的起止范围，将每页显示条目数调整至最大。

复制工具顶部的 JS 代码。在校园卡页面打开开发人员工具的控制台界面并粘贴运行。复制得到的 JSON 数据并粘贴的工具的输入框中，即可解析数据。

工具支持通过日期筛选明细，也可用复选框单独控制每条明细是否计入。完成筛选后，点击下载按钮即可得到 `.csv` 文件。

## 规则编写指南

处理规则定义在 `src/config.ts` 中，类型定义在 `src/config.ts` 中。

`config.ts` 默认导出一个类型为 `ProcessMethod[]` 的数组，每一项描述一条规则，包含其匹配与处理逻辑，均为函数形式。

规则分为两种：一对一规则与多对一规则，通过 `squeeze` 属性标记。

- 一对一规则：一条原始明细对应一条导出明细，通过 `squeeze: false` 或省略来标记。
- 多对一规则：多条相邻的原始明细合并为一条导出明细，通过 `maxTimeDiff` 属性规定最长时间跨度，通过 `squeeze: true` 来标记。

有关更详细的类型信息，TypeScript 类型定义中均有 JSDoc 格式的注释，可以参考。
